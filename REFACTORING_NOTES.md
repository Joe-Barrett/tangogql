# Refactoring Notes

## General

- [x] Clean up the documentation files/folders generated from sphinx
- [x] Move the tests to a test folder
- [x] Move the tests to use PyTests and Coverage
- [x] Create a module folder and move the source code there?
- [ ] Missing setup.py (and maybe .cfg is needed for packaging)
- [ ] Missing LICENSE file
- [ ] Can we remove the static folder?
- [ ] Run PEP8 or Flake8 on the project
- [ ] Document the different modules
- [ ] Use the new formating system for the strings
- [ ] Add pytest.ini or tox.ini or setup.cfg
- [ ] Add config.py

## Documentation

- [ ] Move the docstrings to rst format in order to get a better autogenerated documentation
- [ ] Change the theme of the generated docs
- [ ] Write documentation, not only rely on autogenerated docs
- [ ] Change copyright to MAXIV (in conf.py)

## aioserver.py

- [ ] Clean imports
- [ ] Correct the info about the hostname

## Dockerfile

- Why do we need to use a conda environment inside docker? Ok, because of PyTango and it's dependencies ... maybe we should create a MAXIV base image with all that ...
- We should try to find a better way of getting the source code rather than "git clone" it. Although it works, and that's the important thing

## Dockerfile-test

- Are we using this file at all?

## listener.py

- [ ] Clean unnecessary code
- [ ] Add documentation. Docstrings are OK

## queries.py

- [ ] Move them to the test folder
- [ ] move them from lower letter to capital letters as they are constants
- [ ] Think if this is the best data structure to use

## README.md

- [ ] Re-estructure it a bit, following the template
- [ ] Move unnecessary explanations to the documentation
- [ ] Improve the format
- [ ] Correct the URL shown at starting the server. (maybe localhost)

## requirements.txt

- Do we really need it? Because we are not using it at this moment. Maybe it's ok to keep it in case we improve the installation and we get rid of the conda environment.

## routes.py

- tangoschema. execute? with an space in between ... ??

## schema.py

- [ ] Change TangoSomething by TangoNode
- [ ] The file is quite large with all the classes, distribute them into small modules and combine them in this file by importing them.
- [ ] Refactor the Subscription class methods, there are two for loops that can be avoided just checking the if condition in the first loop, else, break.
- [ ] Missing docstrings in some methods
- [ ] Catching exceptions with "or" statement!? ... replace that code by something like this:

```
try:
   You do your operations here
   ......................
except(Exception1[, Exception2[,...ExceptionN]]]):
   If there is any exception from the given exception list, 
   then execute this block.
   ......................
else:
   If there is no exception then execute this block.
```

Extracted from here:
https://www.tutorialspoint.com/python3/python_exceptions.htm

- [ ] Review if all the staticmethods are really needed as staticmethods, probably not

## tangodb.py

## test.py

- [x] Move tests to pytest - Not really needed, they can be ran with pytest, but anyway ...
- [ ] Don't use more than one assert per test, like this we can remove a lot of duplications
- [ ] Split (if possible) the different classes in different modules
- [ ] Use fixtures
- [ ] Split tests in functional and unit tests.

## ttldict.py

- [ ] Remove duplication of ```if now is None ...```
- [ ] in __setitem__ we can improve the performance is we make the if ... is not None


## General Notes While Refactoring

To run the tests with pytest:

```
pytest --cov=tangogql tests/test.py
```

You need to have installed:

- pytest
- coverage
- pytest-cov

To test adding an html report:

```
pytest --cov-report term-missing --cov-report html --cov=tangogql tests/test.py
```